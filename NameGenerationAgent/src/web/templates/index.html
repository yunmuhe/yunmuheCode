<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能姓名生成系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 2rem auto;
            padding: 2rem;
            max-width: 1200px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            color: #333;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .form-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-generate:disabled {
            opacity: 0.6;
            transform: none;
        }
        
        .results-section {
            background: #fff;
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
            display: none;
        }
        
        .name-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            color: white;
            transition: all 0.3s ease;
        }
        
        .name-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .name-text {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .name-meaning {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
            color: #667eea;
        }
        
        .alert {
            border-radius: 10px;
            border: none;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .stats-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .option-group {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid #e9ecef;
        }
        
        .option-group h6 {
            color: #333;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- 头部 -->
            <div class="header">
                <h1><i class="fas fa-magic"></i> 智能姓名生成系统</h1>
                <p>基于多平台大模型API的智能姓名生成系统，为您的角色创造完美的姓名</p>
            </div>
            
            <!-- 生成表单 -->
            <div class="form-section">
                <form id="nameForm">
                    <div class="row">
                        <div class="col-md-8">
                            <label for="description" class="form-label">
                                <i class="fas fa-user-edit"></i> 角色描述
                            </label>
                            <textarea 
                                class="form-control" 
                                id="description" 
                                name="description" 
                                rows="4" 
                                placeholder="请描述您的角色，例如：一个勇敢的骑士，擅长剑术，性格正直..."
                                required
                            ></textarea>
                        </div>
                        <div class="col-md-4">
                            <label for="count" class="form-label">
                                <i class="fas fa-hashtag"></i> 生成数量
                            </label>
                            <select class="form-select" id="count" name="count">
                                <option value="3">3个姓名</option>
                                <option value="5" selected>5个姓名</option>
                                <option value="8">8个姓名</option>
                                <option value="10">10个姓名</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="options-grid mt-3">
                        <div class="option-group">
                            <h6><i class="fas fa-palette"></i> 文化风格</h6>
                            <select class="form-select" id="cultural_style" name="cultural_style">
                                <option value="chinese_modern">现代中文</option>
                                <option value="chinese_traditional">传统中文</option>
                                <option value="fantasy">奇幻风格</option>
                                <option value="western">西方风格</option>
                            </select>
                        </div>
                        
                        <div class="option-group">
                            <h6><i class="fas fa-venus-mars"></i> 性别</h6>
                            <select class="form-select" id="gender" name="gender">
                                <option value="neutral">中性</option>
                                <option value="male">男性</option>
                                <option value="female">女性</option>
                            </select>
                        </div>
                        
                        <div class="option-group">
                            <h6><i class="fas fa-birthday-cake"></i> 年龄</h6>
                            <select class="form-select" id="age" name="age">
                                <option value="adult">成年人</option>
                                <option value="child">儿童</option>
                                <option value="teen">青少年</option>
                                <option value="elder">长者</option>
                            </select>
                        </div>
                        
                        <div class="option-group">
                            <h6><i class="fas fa-cog"></i> API选择</h6>
                            <select class="form-select" id="preferred_api" name="preferred_api">
                                <option value="">自动选择</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button type="submit" class="btn btn-generate btn-lg">
                            <i class="fas fa-magic"></i> 生成姓名
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- 加载状态 -->
            <div class="loading" id="loading" style="display: none;">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">生成中...</span>
                </div>
                <p class="mt-3">正在生成姓名，请稍候...</p>
            </div>
            
            <!-- 结果展示 -->
            <div class="results-section" id="results">
                <h3><i class="fas fa-star"></i> 生成的姓名</h3>
                <div id="namesContainer"></div>
            </div>
            
            <!-- 系统统计 -->
            <div class="row mt-4" id="statsSection" style="display: none;">
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="totalNames">0</div>
                        <div class="stats-label">已生成姓名</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="availableAPIs">0</div>
                        <div class="stats-label">可用API</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="cacheEntries">0</div>
                        <div class="stats-label">缓存条目</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="successRate">100%</div>
                        <div class="stats-label">成功率</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 全局变量
        let currentResults = [];
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadOptions();
            loadStats();
        });
        
        // 加载可用选项
        async function loadOptions() {
            try {
                const response = await fetch('/options');
                const data = await response.json();
                
                if (data.success) {
                    const apis = data.options.apis;
                    const apiSelect = document.getElementById('preferred_api');
                    
                    // 清空现有选项
                    apiSelect.innerHTML = '<option value="">自动选择</option>';
                    
                    // 添加API选项
                    apis.forEach(api => {
                        const option = document.createElement('option');
                        option.value = api;
                        option.textContent = api.charAt(0).toUpperCase() + api.slice(1);
                        apiSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('加载选项失败:', error);
            }
        }
        
        // 加载系统统计
        async function loadStats() {
            try {
                const response = await fetch('/stats');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('availableAPIs').textContent = stats.available_apis;
                    document.getElementById('cacheEntries').textContent = stats.cache_stats.active_entries;
                    document.getElementById('statsSection').style.display = 'block';
                }
            } catch (error) {
                console.error('加载统计失败:', error);
            }
        }
        
        // 表单提交处理
        document.getElementById('nameForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                description: formData.get('description'),
                count: parseInt(formData.get('count')),
                cultural_style: formData.get('cultural_style'),
                gender: formData.get('gender'),
                age: formData.get('age'),
                preferred_api: formData.get('preferred_api') || null,
                use_cache: true
            };
            
            // 显示加载状态
            showLoading();
            
            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayResults(result);
                    updateStats(result.names.length);
                } else {
                    showError(result.error || '生成失败');
                }
            } catch (error) {
                console.error('请求失败:', error);
                showError('网络错误，请重试');
            } finally {
                hideLoading();
            }
        });
        
        // 显示加载状态
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.querySelector('.btn-generate').disabled = true;
        }
        
        // 隐藏加载状态
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.querySelector('.btn-generate').disabled = false;
        }
        
        // 显示错误信息
        function showError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="alert alert-danger" role="alert">
                    <i class="fas fa-exclamation-triangle"></i> ${message}
                </div>
            `;
            resultsDiv.style.display = 'block';
        }
        
        // 显示生成结果
        function displayResults(result) {
            const resultsDiv = document.getElementById('results');
            const namesContainer = document.getElementById('namesContainer');
            
            if (!result.names || result.names.length === 0) {
                showError('未生成任何姓名，请尝试其他描述');
                return;
            }
            
            // 显示结果标题
            resultsDiv.innerHTML = `
                <h3><i class="fas fa-star"></i> 生成的姓名</h3>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> 
                    使用 ${result.api_name} API 生成了 ${result.names.length} 个姓名
                </div>
                <div id="namesContainer"></div>
            `;
            
            // 重新获取namesContainer引用
            const newNamesContainer = document.getElementById('namesContainer');
            
            // 添加姓名卡片
            result.names.forEach((nameData, index) => {
                const nameCard = document.createElement('div');
                nameCard.className = 'name-card fade-in';
                nameCard.style.animationDelay = `${index * 0.1}s`;
                
                nameCard.innerHTML = `
                    <div class="name-text">${nameData.name}</div>
                    <div class="name-meaning">${nameData.meaning || '寓意待补充'}</div>
                `;
                
                newNamesContainer.appendChild(nameCard);
            });
            
            resultsDiv.style.display = 'block';
            currentResults = result.names;
        }
        
        // 更新统计信息
        function updateStats(newNamesCount) {
            const totalNamesElement = document.getElementById('totalNames');
            const currentTotal = parseInt(totalNamesElement.textContent) || 0;
            totalNamesElement.textContent = currentTotal + newNamesCount;
        }
        
        // 添加一些交互效果
        document.querySelectorAll('.name-card').forEach(card => {
            card.addEventListener('click', function() {
                this.classList.toggle('pulse');
            });
        });
    </script>
</body>
</html>