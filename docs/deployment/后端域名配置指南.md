# åç«¯åŸŸåé…ç½®æŒ‡å—

è®©APPè¿œç¨‹è®¿é—®åç«¯æœåŠ¡çš„å®Œæ•´é…ç½®æ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆé€‰æ‹©

æ ¹æ®æ‚¨çš„éœ€æ±‚å’Œé¢„ç®—ï¼Œé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆï¼š

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | æˆæœ¬ | ç¨³å®šæ€§ | é…ç½®éš¾åº¦ |
|------|---------|------|--------|---------|
| **æ–¹æ¡ˆ1ï¼šäº‘æœåŠ¡å™¨ + åŸŸå** | ç”Ÿäº§ç¯å¢ƒã€é•¿æœŸä½¿ç”¨ | Â¥100+/æœˆ | â­â­â­â­â­ | ä¸­ç­‰ |
| **æ–¹æ¡ˆ2ï¼šå†…ç½‘ç©¿é€æœåŠ¡** | å¼€å‘æµ‹è¯•ã€çŸ­æœŸä½¿ç”¨ | å…è´¹-Â¥50/æœˆ | â­â­â­ | ç®€å• |
| **æ–¹æ¡ˆ3ï¼šåŠ¨æ€DNS** | å®¶åº­å®½å¸¦ã€ä¸ªäººä½¿ç”¨ | å…è´¹-Â¥20/æœˆ | â­â­ | ç®€å• |

---

## ğŸš€ æ–¹æ¡ˆ1ï¼šäº‘æœåŠ¡å™¨ + åŸŸåï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

### 1.1 å‡†å¤‡å·¥ä½œ

**éœ€è¦å‡†å¤‡çš„èµ„æº**ï¼š
- âœ… äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘ECSã€è…¾è®¯äº‘CVMã€åä¸ºäº‘ç­‰ï¼‰
  - æœ€ä½é…ç½®ï¼š1æ ¸2Gï¼Œå¸¦å®½1M
  - ç³»ç»Ÿï¼šUbuntu 20.04 / CentOS 7+
  - é¢„ç®—ï¼šÂ¥100-300/æœˆ
- âœ… åŸŸåï¼ˆé˜¿é‡Œäº‘ä¸‡ç½‘ã€è…¾è®¯äº‘ç­‰ï¼‰
  - ä»·æ ¼ï¼š.comåŸŸå Â¥55/å¹´ï¼Œ.cnåŸŸå Â¥29/å¹´
  - **é‡è¦**ï¼šå¦‚æœæœåŠ¡å™¨åœ¨ä¸­å›½å¤§é™†ï¼ŒåŸŸåéœ€è¦å¤‡æ¡ˆï¼ˆ15-30å¤©ï¼‰
- âœ… SSLè¯ä¹¦ï¼ˆæ¨èå…è´¹Let's Encryptï¼‰

### 1.2 æœåŠ¡å™¨ç¯å¢ƒé…ç½®

#### æ­¥éª¤1ï¼šè¿æ¥åˆ°äº‘æœåŠ¡å™¨

```bash
# Windowsç”¨æˆ·ä½¿ç”¨ PowerShell æˆ– PuTTY
ssh root@ä½ çš„æœåŠ¡å™¨IP

# ä¾‹å¦‚ï¼š
ssh root@47.96.123.45
```

#### æ­¥éª¤2ï¼šå®‰è£…å¿…è¦è½¯ä»¶

```bash
# Ubuntu/Debian ç³»ç»Ÿ
sudo apt update
sudo apt install -y python3 python3-pip python3-venv nginx

# CentOS ç³»ç»Ÿ
sudo yum update
sudo yum install -y python3 python3-pip nginx
```

#### æ­¥éª¤3ï¼šä¸Šä¼ åç«¯ä»£ç 

```bash
# åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼ˆWindows PowerShellï¼‰
cd C:\Users\èƒ¥æ½˜å\Desktop\åå­—ç”Ÿæˆæ™ºèƒ½ä½“

# æ–¹å¼1ï¼šä½¿ç”¨ scp å‘½ä»¤
scp -r NameGenerationAgent root@ä½ çš„æœåŠ¡å™¨IP:/home/

# æ–¹å¼2ï¼šä½¿ç”¨ Gitï¼ˆæ¨èï¼‰
# å…ˆåœ¨æœåŠ¡å™¨ä¸Š
git clone https://github.com/ä½ çš„ç”¨æˆ·å/åå­—ç”Ÿæˆæ™ºèƒ½ä½“.git
cd åå­—ç”Ÿæˆæ™ºèƒ½ä½“/NameGenerationAgent
```

#### æ­¥éª¤4ï¼šé…ç½®åç«¯ç¯å¢ƒ

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /home/NameGenerationAgent

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env  # æˆ–ä½¿ç”¨ vim .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
# APIé…ç½®ï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼‰
PAIOU_API_KEY=sk_your_key_here
AISTUDIO_API_KEY=your_key
AISTUDIO_API_URL=https://api-xxx.aistudio-app.com/v1

# é‡è¦ï¼šCORSé…ç½®ï¼Œå…è®¸ä½ çš„åŸŸåè®¿é—®
ALLOWED_ORIGINS=https://ä½ çš„åŸŸå.com,https://api.ä½ çš„åŸŸå.com

# ç”Ÿäº§ç¯å¢ƒé…ç½®
DEBUG=False
LOG_LEVEL=INFO
```

#### æ­¥éª¤5ï¼šä½¿ç”¨ systemd ç®¡ç†åç«¯æœåŠ¡

åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo nano /etc/systemd/system/nameagent.service
```

å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=Name Generation Agent API
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/home/NameGenerationAgent
Environment="PATH=/home/NameGenerationAgent/venv/bin"
ExecStart=/home/NameGenerationAgent/venv/bin/python main.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
# é‡è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start nameagent

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable nameagent

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status nameagent

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u nameagent -f
```

### 1.3 åŸŸåé…ç½®

#### æ­¥éª¤1ï¼šåŸŸåè§£æ

ç™»å½•åŸŸåæœåŠ¡å•†æ§åˆ¶å°ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰ï¼Œæ·»åŠ DNSè§£æè®°å½•ï¼š

| è®°å½•ç±»å‹ | ä¸»æœºè®°å½• | è®°å½•å€¼ | TTL |
|---------|---------|--------|-----|
| A | @ | ä½ çš„æœåŠ¡å™¨IP | 600 |
| A | api | ä½ çš„æœåŠ¡å™¨IP | 600 |

ç­‰å¾…5-10åˆ†é’Ÿåï¼Œæµ‹è¯•åŸŸåè§£æï¼š

```bash
# åœ¨æœ¬åœ°ç”µè„‘æµ‹è¯•
ping ä½ çš„åŸŸå.com
ping api.ä½ çš„åŸŸå.com
```

### 1.4 Nginx åå‘ä»£ç†é…ç½®

#### æ­¥éª¤1ï¼šåˆ›å»ºNginxé…ç½®æ–‡ä»¶

```bash
sudo nano /etc/nginx/sites-available/nameagent
```

å†™å…¥ä»¥ä¸‹é…ç½®ï¼š

```nginx
# HTTPé…ç½®ï¼ˆä¸´æ—¶æµ‹è¯•ç”¨ï¼‰
server {
    listen 80;
    server_name api.ä½ çš„åŸŸå.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # æ”¯æŒé•¿è¿æ¥
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}
```

#### æ­¥éª¤2ï¼šå¯ç”¨é…ç½®

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/nameagent /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable nginx
```

#### æ­¥éª¤3ï¼šæµ‹è¯•HTTPè®¿é—®

```bash
# åœ¨æœ¬åœ°æµè§ˆå™¨è®¿é—®
http://api.ä½ çš„åŸŸå.com/health

# åº”è¯¥çœ‹åˆ°ï¼š
{"status":"healthy","timestamp":"2025-01-xx..."}
```

### 1.5 é…ç½®HTTPSè¯ä¹¦ï¼ˆé‡è¦ï¼ï¼‰

ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦ï¼š

#### æ­¥éª¤1ï¼šå®‰è£… Certbot

```bash
# Ubuntu/Debian
sudo apt install -y certbot python3-certbot-nginx

# CentOS
sudo yum install -y certbot python3-certbot-nginx
```

#### æ­¥éª¤2ï¼šç”³è¯·è¯ä¹¦

```bash
# è‡ªåŠ¨é…ç½®Nginxå’Œè¯ä¹¦
sudo certbot --nginx -d api.ä½ çš„åŸŸå.com

# æŒ‰æç¤ºè¾“å…¥ï¼š
# 1. é‚®ç®±åœ°å€
# 2. åŒæ„æœåŠ¡æ¡æ¬¾ï¼šY
# 3. æ˜¯å¦é‡å®šå‘HTTPåˆ°HTTPSï¼š2ï¼ˆæ¨èï¼‰
```

#### æ­¥éª¤3ï¼šè‡ªåŠ¨ç»­æœŸ

```bash
# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run

# æ·»åŠ è‡ªåŠ¨ç»­æœŸä»»åŠ¡ï¼ˆå·²è‡ªåŠ¨é…ç½®ï¼‰
sudo systemctl status certbot.timer
```

é…ç½®å®Œæˆåï¼ŒNginxé…ç½®ä¼šè‡ªåŠ¨æ›´æ–°ä¸ºï¼š

```nginx
server {
    listen 80;
    server_name api.ä½ çš„åŸŸå.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name api.ä½ çš„åŸŸå.com;

    ssl_certificate /etc/letsencrypt/live/api.ä½ çš„åŸŸå.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.ä½ çš„åŸŸå.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    location / {
        proxy_pass http://127.0.0.1:5000;
        # ... å…¶ä»–é…ç½®åŒä¸Š
    }
}
```

### 1.6 é˜²ç«å¢™é…ç½®

```bash
# Ubuntu/Debian (ufw)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# CentOS (firewalld)
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

### 1.7 åœ¨APPä¸­é…ç½®åŸŸå

1. æ‰“å¼€APP â†’ è®¾ç½®
2. æ™ºèƒ½ä½“è¿æ¥ â†’ è‡ªå®šä¹‰æœåŠ¡å™¨åœ°å€ â†’ é…ç½®
3. è¾“å…¥ï¼š`https://api.ä½ çš„åŸŸå.com`
4. ç‚¹å‡»"æµ‹è¯•è¿æ¥"
5. ç‚¹å‡»"ä¿å­˜å¹¶ä½¿ç”¨"

âœ… å®Œæˆï¼APPç°åœ¨å¯ä»¥é€šè¿‡åŸŸåè¿œç¨‹è®¿é—®åç«¯äº†ã€‚

---

## ğŸ”§ æ–¹æ¡ˆ2ï¼šå†…ç½‘ç©¿é€æœåŠ¡ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰

é€‚åˆæœ¬åœ°å¼€å‘æœºå™¨ï¼Œæ— éœ€è´­ä¹°æœåŠ¡å™¨å’ŒåŸŸåã€‚

### 2.1 æ–¹æ¡ˆå¯¹æ¯”

| æœåŠ¡ | å…è´¹ç‰ˆé™åˆ¶ | ä»˜è´¹ç‰ˆä»·æ ¼ | ç¨³å®šæ€§ | é€Ÿåº¦ |
|------|-----------|-----------|--------|------|
| **ngrok** | éšæœºåŸŸåã€æœ‰æ—¶é—´é™åˆ¶ | $8/æœˆ | â­â­â­â­ | å¿«ï¼ˆå›½å¤–ï¼‰ |
| **natapp** | éšæœºåŸŸåã€æ¯æ¬¡é‡å¯å˜ | Â¥9/æœˆ | â­â­â­â­ | å¿«ï¼ˆå›½å†…ï¼‰ |
| **èŠ±ç”Ÿå£³** | å…è´¹åŸŸåã€æµé‡é™åˆ¶ | Â¥6/æœˆ | â­â­â­ | ä¸­ç­‰ |
| **frpï¼ˆè‡ªå»ºï¼‰** | éœ€è¦æœ‰å…¬ç½‘æœåŠ¡å™¨ | æœåŠ¡å™¨æˆæœ¬ | â­â­â­â­â­ | å¯æ§ |

### 2.2 ä½¿ç”¨ natappï¼ˆæ¨èå›½å†…ç”¨æˆ·ï¼‰

#### æ­¥éª¤1ï¼šæ³¨å†Œå¹¶è·å–éš§é“

1. è®¿é—®ï¼šhttps://natapp.cn/
2. æ³¨å†Œè´¦å·
3. è´­ä¹°éš§é“ï¼ˆå…è´¹/ä»˜è´¹ï¼‰
   - å…è´¹éš§é“ï¼šéšæœºåŸŸåï¼Œæ¯æ¬¡å¯åŠ¨å˜åŒ–
   - VIP_1å‹ï¼ˆÂ¥9/æœˆï¼‰ï¼šå›ºå®šåŸŸå

#### æ­¥éª¤2ï¼šä¸‹è½½å®¢æˆ·ç«¯

```bash
# Windows
# ä¸‹è½½ï¼šhttps://natapp.cn/download/natapp_windows_amd64.zip
# è§£å‹åˆ°ï¼šC:\Users\èƒ¥æ½˜å\Desktop\åå­—ç”Ÿæˆæ™ºèƒ½ä½“\natapp\
```

#### æ­¥éª¤3ï¼šé…ç½®å¹¶å¯åŠ¨

åˆ›å»ºé…ç½®æ–‡ä»¶ `natapp/config.ini`ï¼š

```ini
[default]
authtoken=ä½ çš„authtokenï¼ˆåœ¨natappç½‘ç«™è·å–ï¼‰
clienttoken=ä½ çš„clienttoken
log=stdout
loglevel=DEBUG
```

å¯åŠ¨natappï¼š

```bash
cd natapp
natapp.exe -authtoken=ä½ çš„authtoken
```

ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

```
Tunnel Status: online
Forwarding: http://abc123.natappfree.cc -> 127.0.0.1:5000
Forwarding: https://abc123.natappfree.cc -> 127.0.0.1:5000
```

#### æ­¥éª¤4ï¼šé…ç½®åç«¯CORS

ç¼–è¾‘ `NameGenerationAgent/.env`ï¼š

```bash
ALLOWED_ORIGINS=https://abc123.natappfree.cc
```

é‡å¯åç«¯ï¼š

```bash
cd NameGenerationAgent
venv\Scripts\activate
python main.py
```

#### æ­¥éª¤5ï¼šåœ¨APPä¸­é…ç½®

åœ¨APPè®¾ç½®ä¸­è¾“å…¥ï¼š`https://abc123.natappfree.cc`

### 2.3 ä½¿ç”¨ ngrokï¼ˆå›½é™…ç”¨æˆ·ï¼‰

#### æ­¥éª¤1ï¼šå®‰è£…

```bash
# ä¸‹è½½ï¼šhttps://ngrok.com/download
# Windows: è§£å‹åˆ°ä»»æ„ç›®å½•
```

#### æ­¥éª¤2ï¼šæ³¨å†Œå¹¶è·å–token

1. è®¿é—®ï¼šhttps://dashboard.ngrok.com/signup
2. è·å–authtoken

#### æ­¥éª¤3ï¼šé…ç½®å¹¶å¯åŠ¨

```bash
# é…ç½®tokenï¼ˆåªéœ€ä¸€æ¬¡ï¼‰
ngrok config add-authtoken ä½ çš„token

# å¯åŠ¨éš§é“
ngrok http 5000
```

ä¼šæ˜¾ç¤ºï¼š

```
Forwarding: https://xxxx-xx-xx-xx-xx.ngrok-free.app -> http://localhost:5000
```

#### æ­¥éª¤4ï¼šé…ç½®åç«¯å’ŒAPP

åŒnatappï¼Œæ›´æ–°CORSå’ŒAPPé…ç½®ã€‚

### 2.4 ä½¿ç”¨èŠ±ç”Ÿå£³

#### æ­¥éª¤1ï¼šä¸‹è½½å®‰è£…

1. è®¿é—®ï¼šhttps://hsk.oray.com/download/
2. ä¸‹è½½å¹¶å®‰è£…Windowså®¢æˆ·ç«¯

#### æ­¥éª¤2ï¼šé…ç½®æ˜ å°„

1. ç™»å½•èŠ±ç”Ÿå£³å®¢æˆ·ç«¯
2. æ·»åŠ æ˜ å°„ï¼š
   - åº”ç”¨åç§°ï¼šå§“åç”ŸæˆAPI
   - å†…ç½‘ä¸»æœºï¼š127.0.0.1
   - å†…ç½‘ç«¯å£ï¼š5000
   - å¤–ç½‘ç«¯å£ï¼š80ï¼ˆHTTPï¼‰æˆ–443ï¼ˆHTTPSï¼‰

#### æ­¥éª¤3ï¼šè·å–å¤–ç½‘åœ°å€

ä¼šè·å¾—ç±»ä¼¼ï¼š`http://xxxx.xicp.net` çš„åœ°å€

---

## ğŸ  æ–¹æ¡ˆ3ï¼šåŠ¨æ€DNSï¼ˆå®¶åº­å®½å¸¦ï¼‰

å¦‚æœæ‚¨æœ‰å›ºå®šå…¬ç½‘IPæˆ–åŠ¨æ€å…¬ç½‘IPã€‚

### 3.1 æ£€æŸ¥æ˜¯å¦æœ‰å…¬ç½‘IP

```bash
# è®¿é—®ä»¥ä¸‹ç½‘ç«™æŸ¥çœ‹å…¬ç½‘IP
https://ip.cn
https://www.ip138.com

# å¯¹æ¯”è·¯ç”±å™¨æ˜¾ç¤ºçš„WAN IP
# å¦‚æœä¸€è‡´ = æœ‰å…¬ç½‘IP
# å¦‚æœä¸åŒ = æ²¡æœ‰å…¬ç½‘IPï¼ˆNATåï¼‰
```

### 3.2 ç”³è¯·å…¬ç½‘IP

è‡´ç”µè¿è¥å•†å®¢æœï¼ˆç”µä¿¡10000ã€è”é€š10010ã€ç§»åŠ¨10086ï¼‰ï¼š

> "æ‚¨å¥½ï¼Œæˆ‘éœ€è¦ç”³è¯·å…¬ç½‘IPç”¨äºè¿œç¨‹åŠå…¬ï¼Œè¯·å¸®æˆ‘å¼€é€šIPv4å…¬ç½‘åœ°å€"

é€šå¸¸å…è´¹ï¼Œéƒ¨åˆ†åœ°åŒºå¯èƒ½éœ€è¦æ›´æ¢å¥—é¤ã€‚

### 3.3 é…ç½®åŠ¨æ€DNS

æ¨èæœåŠ¡ï¼š
- é˜¿é‡Œäº‘DDNSï¼ˆå¦‚æœæœ‰é˜¿é‡Œäº‘è´¦å·ï¼‰
- èŠ±ç”Ÿå£³åŠ¨æ€åŸŸå
- No-IPï¼ˆå›½é™…ï¼‰

ä»¥èŠ±ç”Ÿå£³ä¸ºä¾‹ï¼š

1. æ³¨å†ŒèŠ±ç”Ÿå£³å¹¶å®åè®¤è¯
2. è·å¾—å…è´¹åŸŸåï¼ˆå¦‚ `yourname.zicp.net`ï¼‰
3. å®‰è£…èŠ±ç”Ÿå£³å®¢æˆ·ç«¯ï¼ˆå¼€æœºè‡ªå¯ï¼‰
4. è·¯ç”±å™¨å¼€æ”¾ç«¯å£5000
5. é…ç½®åç«¯CORS
6. åœ¨APPä¸­ä½¿ç”¨èŠ±ç”Ÿå£³åŸŸå

### 3.4 è·¯ç”±å™¨ç«¯å£è½¬å‘

ç™»å½•è·¯ç”±å™¨ç®¡ç†ç•Œé¢ï¼ˆé€šå¸¸æ˜¯ `192.168.1.1`ï¼‰ï¼š

```
ç«¯å£æ˜ å°„é…ç½®ï¼š
å¤–éƒ¨ç«¯å£ï¼š5000
å†…éƒ¨IPï¼š192.168.x.xï¼ˆä½ çš„ç”µè„‘IPï¼‰
å†…éƒ¨ç«¯å£ï¼š5000
åè®®ï¼šTCP
```

---

## ğŸ“± å‰ç«¯APPé…ç½®æ›´æ–°

### æ›´æ–°åç«¯CORSé…ç½®

ç¼–è¾‘ `NameGenerationAgent/.env`ï¼š

```bash
# æ·»åŠ ä½ çš„åŸŸååˆ°å…è®¸åˆ—è¡¨
ALLOWED_ORIGINS=https://api.ä½ çš„åŸŸå.com,https://abc.natappfree.cc,http://localhost:5173

# å¤šä¸ªåŸŸåç”¨é€—å·åˆ†éš”
```

### APPä¸­é…ç½®åŸŸå

åœ¨è®¾ç½®é¡µé¢è¾“å…¥å®Œæ•´URLï¼š

```
äº‘æœåŠ¡å™¨ï¼šhttps://api.ä½ çš„åŸŸå.com
natappï¼šhttps://abc123.natappfree.cc
ngrokï¼šhttps://xxxx.ngrok-free.app
èŠ±ç”Ÿå£³ï¼šhttp://xxxx.xicp.net
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. åç«¯å¥åº·æ£€æŸ¥

```bash
# æ–¹å¼1ï¼šæµè§ˆå™¨è®¿é—®
https://api.ä½ çš„åŸŸå.com/health

# æ–¹å¼2ï¼šcurlå‘½ä»¤
curl https://api.ä½ çš„åŸŸå.com/health

# é¢„æœŸè¾“å‡ºï¼š
{"status":"healthy","timestamp":"2025-01-27...","version":"1.0"}
```

### 2. æµ‹è¯•ç”Ÿæˆæ¥å£

```bash
curl -X POST https://api.ä½ çš„åŸŸå.com/generate \
  -H "Content-Type: application/json" \
  -d '{
    "description": "æ¸©æŸ”å–„è‰¯çš„å¥³å­©",
    "count": 3,
    "cultural_style": "modern",
    "gender": "female",
    "age": "youth"
  }'
```

### 3. APPç«¯æµ‹è¯•

1. æ‰“å¼€APP
2. è¿›å…¥"ç”Ÿæˆ"é¡µé¢
3. è¾“å…¥æè¿°ï¼Œç‚¹å‡»ç”Ÿæˆ
4. æŸ¥çœ‹æ˜¯å¦æ­£å¸¸è¿”å›ç»“æœ

---

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. APIè®¿é—®æ§åˆ¶ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦é™åˆ¶è®¿é—®ï¼Œå¯ä»¥æ·»åŠ API KeyéªŒè¯ï¼š

ç¼–è¾‘ `NameGenerationAgent/src/web/app.py`ï¼š

```python
from functools import wraps
from flask import request, jsonify

API_KEY = "ä½ çš„å¯†é’¥"  # æˆ–ä»ç¯å¢ƒå˜é‡è¯»å–

def require_api_key(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        api_key = request.headers.get('X-API-Key')
        if api_key != API_KEY:
            return jsonify({'error': 'Invalid API key'}), 401
        return f(*args, **kwargs)
    return decorated_function

# åœ¨éœ€è¦ä¿æŠ¤çš„è·¯ç”±æ·»åŠ è£…é¥°å™¨
@app.route('/generate', methods=['POST'])
@require_api_key
def generate_route():
    # ... åŸæœ‰ä»£ç 
```

å‰ç«¯ `api.ts` ä¸­æ·»åŠ headerï¼š

```typescript
function request(options: RequestOptions): Promise<any> {
    return ensureServerUrl().then(() => {
        return new Promise((resolve, reject) => {
            uni.request({
                url: BASE_URL + options.url,
                method: options.method || 'GET',
                data: options.data,
                header: {
                    'Content-Type': 'application/json',
                    'X-API-Key': 'ä½ çš„å¯†é’¥'  // æ·»åŠ è¿™è¡Œ
                },
                // ...
            });
        });
    });
}
```

### 2. é™æµä¿æŠ¤

å®‰è£…Flaské™æµæ‰©å±•ï¼š

```bash
pip install Flask-Limiter
```

é…ç½®é™æµï¼š

```python
from flask_limiter import Limiter
from flask_limiter.util import get_remote_address

limiter = Limiter(
    app=app,
    key_func=get_remote_address,
    default_limits=["200 per day", "50 per hour"]
)

@app.route('/generate', methods=['POST'])
@limiter.limit("10 per minute")
def generate_route():
    # ...
```

### 3. HTTPSå¼ºåˆ¶è·³è½¬

ç¡®ä¿æ‰€æœ‰HTTPè¯·æ±‚éƒ½é‡å®šå‘åˆ°HTTPSï¼ˆå·²åœ¨Nginxé…ç½®ä¸­ï¼‰ã€‚

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### 1. æŸ¥çœ‹åç«¯æ—¥å¿—

```bash
# systemdæœåŠ¡æ—¥å¿—
sudo journalctl -u nameagent -f

# åº”ç”¨æ—¥å¿—
tail -f /home/NameGenerationAgent/logs/app.log
```

### 2. ç›‘æ§æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status nameagent

# æŸ¥çœ‹NginxçŠ¶æ€
sudo systemctl status nginx

# æŸ¥çœ‹ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 5000
```

### 3. è‡ªåŠ¨é‡å¯ç­–ç•¥

systemdæœåŠ¡é…ç½®ä¸­å·²åŒ…å« `Restart=always`ï¼ŒæœåŠ¡å´©æºƒä¼šè‡ªåŠ¨é‡å¯ã€‚

### 4. å¤‡ä»½ç­–ç•¥

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
nano /home/backup_nameagent.sh
```

```bash
#!/bin/bash
BACKUP_DIR="/home/backups"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR
tar -czf $BACKUP_DIR/nameagent_$DATE.tar.gz /home/NameGenerationAgent

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "nameagent_*.tar.gz" -mtime +7 -delete
```

æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ï¼š

```bash
chmod +x /home/backup_nameagent.sh
crontab -e

# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /home/backup_nameagent.sh
```

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: åŸŸåè§£æä¸ç”Ÿæ•ˆ

**æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥DNSè§£æ
nslookup api.ä½ çš„åŸŸå.com

# æ£€æŸ¥æœåŠ¡å™¨ç«¯
curl http://127.0.0.1:5000/health
```

**è§£å†³**ï¼š
- ç­‰å¾…DNSç”Ÿæ•ˆï¼ˆæœ€å¤š48å°æ—¶ï¼Œé€šå¸¸10åˆ†é’Ÿï¼‰
- æ£€æŸ¥åŸŸåè§£æè®°å½•æ˜¯å¦æ­£ç¡®
- æ¸…é™¤æœ¬åœ°DNSç¼“å­˜ï¼š`ipconfig /flushdns`

### Q2: HTTPSè¯ä¹¦ç”³è¯·å¤±è´¥

**åŸå› **ï¼š
- åŸŸåè§£ææœªç”Ÿæ•ˆ
- 80ç«¯å£æœªå¼€æ”¾
- é˜²ç«å¢™æ‹¦æˆª

**è§£å†³**ï¼š
```bash
# ç¡®ä¿80ç«¯å£å¯è®¿é—®
sudo ufw allow 80/tcp
sudo systemctl restart nginx

# å†æ¬¡ç”³è¯·
sudo certbot --nginx -d api.ä½ çš„åŸŸå.com
```

### Q3: APPè¿æ¥è¶…æ—¶

**æ£€æŸ¥æ¸…å•**ï¼š
1. âœ… åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`sudo systemctl status nameagent`
2. âœ… Nginxæ˜¯å¦è¿è¡Œï¼š`sudo systemctl status nginx`
3. âœ… é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ï¼š`sudo ufw status`
4. âœ… CORSé…ç½®æ˜¯å¦æ­£ç¡®ï¼šæ£€æŸ¥ `.env` ä¸­ `ALLOWED_ORIGINS`
5. âœ… APPä¸­åŸŸåæ˜¯å¦æ­£ç¡®ï¼š`https://api.ä½ çš„åŸŸå.com`

### Q4: 502 Bad Gateway

**åŸå› **ï¼šNginxæ— æ³•è¿æ¥åˆ°åç«¯Flaskåº”ç”¨

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
sudo systemctl status nameagent

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 5000

# é‡å¯åç«¯
sudo systemctl restart nameagent

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u nameagent -n 50
```

---

## ğŸ¯ æ¨èé…ç½®

æ ¹æ®ä¸åŒåœºæ™¯çš„æœ€ä½³å®è·µï¼š

### ä¸ªäººå¼€å‘æµ‹è¯•
- ä½¿ç”¨ **natappå…è´¹ç‰ˆ** æˆ– **ngrok**
- æˆæœ¬ï¼šå…è´¹
- æ—¶é—´ï¼š5åˆ†é’Ÿé…ç½®å®Œæˆ

### å›¢é˜Ÿåä½œå¼€å‘
- ä½¿ç”¨ **natapp VIPç‰ˆ**ï¼ˆå›ºå®šåŸŸåï¼‰
- æˆæœ¬ï¼šÂ¥9/æœˆ
- ç¨³å®šæ€§å¥½ï¼Œå›¢é˜Ÿå¯å…±äº«è®¿é—®

### æ­£å¼ä¸Šçº¿ç”Ÿäº§
- ä½¿ç”¨ **äº‘æœåŠ¡å™¨ + åŸŸå + HTTPS**
- æˆæœ¬ï¼šÂ¥100-300/æœˆ
- æœ€ç¨³å®šå¯é ï¼Œæ”¯æŒé«˜å¹¶å‘

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé…ç½®è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`NameGenerationAgent/logs/app.log`
2. æŸ¥çœ‹Nginxæ—¥å¿—ï¼š`/var/log/nginx/error.log`
3. è¿è¡Œè¯Šæ–­è„šæœ¬ï¼š`test_server_discovery.bat`
4. æ£€æŸ¥é˜²ç«å¢™å’Œç«¯å£ï¼š`netstat -tlnp`

---

**ç¥é…ç½®é¡ºåˆ©ï¼ğŸ‰**
