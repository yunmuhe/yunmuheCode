# 问题诊断和解决方案

## 当前问题

### 1. uni-ui组件未找到 ✅ 已修复
**症状**：`Failed to resolve component: uni-nav-bar`

**已修复**：在 `pages.json` 中添加了 easycom 配置

### 2. 健康检查超时
**症状**：`[API Error] GET http://127.0.0.1:5000/health - request:fail timeout`

**原因**：
- H5浏览器模式下，默认使用 `http://127.0.0.1:5000`
- 后端虽然运行中，但首次请求可能超时（15秒默认超时）

**解决方案**：

#### 方案A：重启前端（推荐）
```bash
# 1. 停止当前的前端服务（Ctrl+C）

# 2. 重新启动
cd 智能姓名生成系统
npm run dev:h5

# 3. 等待编译完成后访问
```

#### 方案B：手动刷新浏览器
1. 在浏览器中按 `F5` 刷新页面
2. 如果仍然超时，清除浏览器缓存（`Ctrl+Shift+Delete`）
3. 再次刷新

#### 方案C：检查后端
```bash
# 确认后端正在运行
cd NameGenerationAgent
python main.py

# 应该看到类似输出：
# [成功] Flask应用启动成功
# [访问] 访问地址: http://localhost:5000
```

#### 方案D：测试后端连通性
```bash
# 在浏览器中直接访问
http://127.0.0.1:5000/health

# 应该返回JSON:
# {"status":"healthy","timestamp":"..."}
```

## 最新改进

### 1. 服务器发现优化 ✅
- 未找到可用服务器时，不再抛出错误
- 自动使用默认地址 `http://127.0.0.1:5000`
- 避免阻塞UI加载

### 2. uni-ui组件支持 ✅
- 添加了 easycom 自动导入配置
- 支持 `uni-nav-bar`、`uni-icons`、`uni-number-box` 等组件

## 快速测试步骤

### 步骤1：测试后端
```bash
curl http://127.0.0.1:5000/health
```
应该看到：`{"status":"healthy",...}`

### 步骤2：测试前端H5
1. 启动前端：`npm run dev:h5`
2. 浏览器访问：`http://localhost:5173`
3. 进入"设置"页面
4. 查看"智能体连接"部分

**预期结果**：
- 当前服务器：显示 `http://127.0.0.1:5000`
- 连接状态：绿点 + "已连接"

### 步骤3：测试Android模拟器
1. 确保后端运行中
2. 配置防火墙（如果还没配置）：
   ```
   setup_firewall.bat  # 以管理员身份运行
   ```
3. 打开模拟器中的应用
4. 进入"设置" → "智能体连接"
5. 点击"自动发现"或手动输入IP

## 调试技巧

### 查看控制台日志
在浏览器开发者工具（F12）的Console中查看：
- `[Server Discovery]` - 服务器发现日志
- `[API Request]` - API请求日志
- `[API Error]` - 错误信息

### 常见错误及解决

#### 错误1：timeout
**原因**：后端未运行或防火墙阻止

**解决**：
```bash
# 检查后端
netstat -ano | findstr ":5000"

# 如果没有输出，启动后端
cd NameGenerationAgent && python main.py
```

#### 错误2：CORS error
**原因**：后端未配置允许的Origin

**解决**：编辑 `NameGenerationAgent/.env`
```
ALLOWED_ORIGINS=http://localhost:5173,http://127.0.0.1:5173
```

#### 错误3：404 Not Found
**原因**：后端路由不存在

**解决**：确保使用正确的API端点
- `/health` - 健康检查
- `/options` - 获取选项
- `/generate` - 生成姓名

## 下一步

1. ✅ 前端uni-ui组件已修复
2. ✅ 服务器发现机制已优化
3. 🔄 重启前端测试
4. 🔄 在Android模拟器中测试自动发现功能

## 需要帮助？

如果问题仍然存在：
1. 检查 `NameGenerationAgent/logs/app.log` 查看后端日志
2. 在浏览器Console查看前端错误
3. 运行 `test_server_discovery.bat` 诊断环境
